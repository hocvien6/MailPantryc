#include <stdio.h>
#include <stdlib.h>
#include <time.h>

int sendmail() {
	FILE *pipe;

	int bytes_read;
	size_t nbytes = 100;
	char *result;

	pipe = popen("./simultmail.sh", "r");

	/* Check that pipes are non-null, therefore open */
	if ((!pipe)) {
		fprintf(stderr, "Pipe failed.\n");
		return EXIT_FAILURE;
	}
	/* Read from ps_pipe until two newlines */
	result = (char *) malloc(nbytes + 1);
	bytes_read = getdelim(&result, &nbytes, (int) "\n", pipe);

	printf("%s\n", result);
	printf("bytes_read: %d\n", bytes_read);

	/* Close ps_pipe, checking for errors */
	if (pclose(pipe) != 0) {
		fprintf(stderr, "Could not run, or other error.\n");
	}

	/* Exit! */
	return 0;
}
